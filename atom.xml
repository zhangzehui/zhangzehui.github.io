<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zhangzehui.github.io</id>
    <title>Gridea</title>
    <updated>2020-09-17T12:23:35.994Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://zhangzehui.github.io"/>
    <link rel="self" href="https://zhangzehui.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://zhangzehui.github.io/images/avatar.png</logo>
    <icon>https://zhangzehui.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[Android Handler åŸç†ä»‹ç»]]></title>
        <id>https://zhangzehui.github.io/post/android-handler-yuan-li-jie-shao/</id>
        <link href="https://zhangzehui.github.io/post/android-handler-yuan-li-jie-shao/">
        </link>
        <updated>2020-09-17T12:20:50.000Z</updated>
        <content type="html"><![CDATA[<ol>
<li>
<p>Handlerçš„ä½¿ç”¨:<br>
ï¼ˆ1ï¼‰å­çº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¹‹é—´ç›¸äº’å‘é€æ¶ˆæ¯<br>
ï¼ˆ2ï¼‰æ‰§è¡Œå»¶æ—¶ä»»åŠ¡</p>
</li>
<li>
<p>åŸºæœ¬ä½¿ç”¨ï¼š</p>
</li>
</ol>
<pre><code>Looper.prepare();
Handler mHandler = new Handler() {  
    @Override public void handleMessage(@NonNull Message msg) {  
        super.handleMessage(msg);  
    }  
};  
mHandler.sendEmptyMessage(0);
Looper.loop();
</code></pre>
<ol start="3">
<li>åŸç†æ¦‚è¿°ï¼š</li>
</ol>
<p>Looper.prepare()ä¼šåˆ›å»ºä¸€ä¸ªLooperå¯¹è±¡ï¼Œè¿™ä¸ªLooperå¯¹è±¡æ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ï¼Œé€šè¿‡ThreadLocalä¿å­˜ã€‚åˆ›å»ºLooperå¯¹è±¡æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªMessageQueueå¯¹è±¡ç”¨äºå­˜æ”¾æ¶ˆæ¯ã€‚Handlerå‘é€çš„æ¶ˆæ¯Messageä¼šä¿å­˜åœ¨è¿™ä¸ªMessageQueueä¸­ã€‚</p>
<p>åˆ›å»ºHandlerå¯¹è±¡æ—¶ï¼Œä¼šè·ŸLooperå¯¹è±¡ç›¸å…³è”ï¼Œé»˜è®¤çš„æ˜¯è·Ÿæœ¬çº¿ç¨‹ä¸­Looperå¯¹è±¡å…³è”ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥å…¶ä»–çº¿ç¨‹ä¸­çš„Looperå¯¹è±¡ã€‚</p>
<p>Looper.loop()ä¼šå¼€å¯ä¸€ä¸ªæ­»å¾ªç¯ç”¨äºæ¥æ”¶Handlerå‘é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œä¸€èˆ¬æ˜¯æ‰§è¡ŒHandlerçš„handleMessageæ–¹æ³•ã€‚</p>
<ol start="4">
<li>åŸç†è¯¦è§£<br>
Looper.prepare()ï¼Œ é€šè¿‡ThreadLocalä¿å­˜æ–°çš„Looperå¯¹è±¡ã€‚</li>
</ol>
<pre><code>83    public static void prepare() {  
84        prepare(true);  
85    }  
86  
87    private static void prepare(boolean quitAllowed) {  
88        if (sThreadLocal.get() != null) {  
89            throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);  
90        }  
91        sThreadLocal.set(new Looper(quitAllowed));  
92    } 
</code></pre>
<p>Looperçš„æ„é€ å‡½æ•°ï¼šåˆ›å»ºMessageQueueå¯¹è±¡ï¼Œç”¨äºä¿å­˜Handlerå‘é€çš„Messageå¯¹è±¡</p>
<pre><code>197    private Looper(boolean quitAllowed) {  
198        mQueue = new MessageQueue(quitAllowed);  
199        mThread = Thread.currentThread();  
200    }  
</code></pre>
<p>Handlerçš„æ„é€ å‡½æ•°ï¼ŒHandleræœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œä¸»è¦ç”¨æ¥åˆå§‹åŒ–mLooperã€mQueueã€mCallBackã€mAsynchronouså¯¹è±¡ã€‚å¦‚æœæœªä¼ å…¥å‚æ•°ï¼Œåˆ™ä½¿ç”¨å½“å‰çº¿ç¨‹çš„é»˜è®¤å€¼ã€‚</p>
<pre><code>227    public Handler(Looper looper, Callback callback, boolean async) {  
228        mLooper = looper;  
229        mQueue = looper.mQueue;  
230        mCallback = callback;  
231        mAsynchronous = async;  
232    }  

 
188    public Handler(Callback callback, boolean async) {  
189        if (FIND_POTENTIAL_LEAKS) {  
190            final Class&lt;? extends Handler&gt; klass = getClass();  
191            if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;  
192                    (klass.getModifiers() &amp; Modifier.STATIC) == 0) {  
193                Log.w(TAG, &quot;The following Handler class should be static or leaks might occur: &quot; +  
194                    klass.getCanonicalName());  
195            }  
196        }  
197  
198        mLooper = Looper.myLooper();  
199        if (mLooper == null) {  
200            throw new RuntimeException(  
201                &quot;Can't create handler inside thread that has not called Looper.prepare()&quot;);  
202        }  
203        mQueue = mLooper.mQueue;  
204        mCallback = callback;  
205        mAsynchronous = async;  
206    }  


113    public Handler() {  
114        this(null, false);  
115    }  
116  
  
127    public Handler(Callback callback) {  
128        this(callback, false);  
129    }  
130  
  
136    public Handler(Looper looper) {  
137        this(looper, null, false);  
138    }  
139  
  
147    public Handler(Looper looper, Callback callback) {  
148        this(looper, callback, false);  
149    }  
150  
  
167    public Handler(boolean async) {  
168        this(null, async);  
169    }
</code></pre>
<p>Handlerå‘é€æ¶ˆæ¯ï¼šHandleré€šè¿‡ä¸€ç³»åˆ—å‘é€æ¶ˆæ¯çš„æ–¹æ³•å°†æ¶ˆæ¯å‘é€ç»™Looperä¸­çš„MessageQueueä¸­</p>
<p>Handlerçš„ä¼—å¤šå‘é€æ¶ˆæ¯çš„æ–¹æ³•æœ€ç»ˆéƒ½ä¼šèµ°åˆ°åŒä¸€ä¸ªå‡½æ•°enqueueMessageï¼š</p>
<pre><code>638    private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {  
639        msg.target = this;  //å°†msg.targetèµ‹å€¼ç»™äº†å½“å‰Handlerå¯¹è±¡
640        if (mAsynchronous) {  
641            msg.setAsynchronous(true);  
642        }  
643        return queue.enqueueMessage(msg, uptimeMillis);  
644    }  
</code></pre>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°å°†å½“å‰çš„msgå¯¹è±¡åŠ å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—ä¸­å›½ã€‚å¹¶ä¸”å°†msg.targetèµ‹å€¼ç»™äº†å½“å‰Handlerå¯¹è±¡ã€‚</p>
<p>Looper.loop()æ–¹æ³•ï¼šå¼€å¯å¤„ç†æ¶ˆæ¯çš„æ— é™å¾ªç¯</p>
<pre><code>123    public static void loop() {  
124        final Looper me = myLooper();  //è¿”å›å½“å‰çº¿ç¨‹çš„Looperå¯¹è±¡ï¼Œä¿å­˜åœ¨ThreadLocalä¸­
125        if (me == null) {  
126            throw new RuntimeException(&quot;No Looper; Looper.prepare() wasn't called on this thread.&quot;);  
127        }  
128        final MessageQueue queue = me.mQueue;  // æ‹¿åˆ°MessageQueueå¯¹è±¡
129  
130        // Make sure the identity of this thread is that of the local process,  
131        // and keep track of what that identity token actually is.  
132        Binder.clearCallingIdentity();  
133        final long ident = Binder.clearCallingIdentity();  
134  
135        for (;;) {  //å¤„ç†Handlerå‘é€æ¶ˆæ¯çš„æ— çº¿å¾ªç¯
136            Message msg = queue.next(); // might block  
137            if (msg == null) {  
138                // No message indicates that the message queue is quitting.  
139                return;  
140            }  
141  
142            // This must be in a local variable, in case a UI event sets the logger  
143            final Printer logging = me.mLogging;  
144            if (logging != null) {  
145                logging.println(&quot;&gt;&gt;&gt;&gt;&gt; Dispatching to &quot; + msg.target + &quot; &quot; +  
146                        msg.callback + &quot;: &quot; + msg.what);  
147            }  
148  
149            final long traceTag = me.mTraceTag;  
150            if (traceTag != 0) {  
151                Trace.traceBegin(traceTag, msg.target.getTraceName(msg));  
152            }  
153            try {  
154                msg.target.dispatchMessage(msg);  //è¿™é‡Œçš„msg.targetå°±æ˜¯Handler
155            } finally {  
156                if (traceTag != 0) {  
157                    Trace.traceEnd(traceTag);  
158                }  
159            }  
160  
161            if (logging != null) {  
162                logging.println(&quot;&lt;&lt;&lt;&lt;&lt; Finished to &quot; + msg.target + &quot; &quot; + msg.callback);  
163            }  
164  
165            // Make sure that during the course of dispatching the  
166            // identity of the thread wasn't corrupted.  
167            final long newIdent = Binder.clearCallingIdentity();  
168            if (ident != newIdent) {  
169                Log.wtf(TAG, &quot;Thread identity changed from 0x&quot;  
170                        + Long.toHexString(ident) + &quot; to 0x&quot;  
171                        + Long.toHexString(newIdent) + &quot; while dispatching to &quot;  
172                        + msg.target.getClass().getName() + &quot; &quot;  
173                        + msg.callback + &quot; what=&quot; + msg.what);  
174            }  
175  
176            msg.recycleUnchecked();  
177        }  
178    }  
</code></pre>
<p>Handlerçš„dispatchMessageå‡½æ•°ï¼š</p>
<pre><code>93    public void dispatchMessage(Message msg) {  
94        if (msg.callback != null) {  
95            handleCallback(msg);  
96        } else {  
97            if (mCallback != null) {  
98                if (mCallback.handleMessage(msg)) {  
99                    return;  
100                }  
101            }  
102            handleMessage(msg);  
103        }  
104    }  
</code></pre>
<p>å¦‚æœæœ‰å¯¹åº”çš„callbackå¯¹è±¡ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„å›è°ƒï¼Œå¦åˆ™æ‰§è¡ŒHandlerçš„handleMessageã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello World]]></title>
        <id>https://zhangzehui.github.io/post/hello-world/</id>
        <link href="https://zhangzehui.github.io/post/hello-world/">
        </link>
        <updated>2020-09-17T12:15:07.000Z</updated>
        <content type="html"><![CDATA[<p>Hello world!</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://zhangzehui.github.io/post/hello-gridea/</id>
        <link href="https://zhangzehui.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>